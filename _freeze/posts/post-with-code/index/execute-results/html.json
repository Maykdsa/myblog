{
  "hash": "f8afd27008230156488912656697a5b4",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Atividade Cotação do Dólar\"\nauthor: \"Mayk\"\ndate: \"2025-11-23\"\ncategories: [api, code, python, Dollar]\njupyter: python3\n\n---\n\nNeste Post está a atividade sobre a cotação do Dollar.\n\n---\n\n\n# Introdução\n\nEste blog apresenta a análise das cotações do dólar utilizando dados fornecidos pela API oficial do Banco Central (PTAX). O objetivo deste trabalho é demonstrar o uso de Python para realizar consultas em APIs, tratamento de dados, geração de gráficos e construção de um blog com Quarto.\n\nAo longo deste documento, cada célula de código será explicada detalhadamente.\n\n---\n\n# Imports Necessários\n\nAntes de qualquer coisa, é preciso importar todas as bibliotecas utilizadas no projeto.\n\n\n```python\nimport calendar\nfrom datetime import datetime, timedelta\nimport pandas as pd\nimport plotly.express as px\nimport requests\n```\n\n---\n\n# Função para Obter Datas do Mês\n\nEsta função recebe um mês no formato **MMYYYY** e retorna o primeiro e o último dia daquele mês.\n\n```python\ndef datas(mes: str) -> tuple[datetime, datetime]:\n    \"\"\"\n    Recebe o mês no formato MMYYYY e retorna a primeira e última data do mês.\n    \"\"\"\n    data_inicial = datetime.strptime(mes, \"%m%Y\")\n    ultimo_dia = calendar.monthrange(data_inicial.year, data_inicial.month)[1]\n    data_final = data_inicial.replace(day=ultimo_dia)\n    return data_inicial, data_final\n```\n\n---\n\n# Construção das Consultas para a API\n\nAs funções abaixo montam as URLs de consulta ao Banco Central.\n\n```python\ndef construir_query_periodo(data_inicial: datetime, data_final: datetime) -> str:\n    return (\n        f\"?%40dataInicial='{data_inicial.strftime('%m%d%Y')}'\"\n        f\"&%40dataFinalCotacao='{data_final.strftime('%m%d%Y')}'\"\n        \"&%24format=json\"\n    )\n\n\ndef construir_query_dia(data: datetime) -> str:\n    return f\"?%40dataCotacao='{data.strftime('%m%d%Y')}'&%24format=json\"\n```\n\n---\n\n# Consulta dos Dados na API PTAX\n\nConsultamos tanto um período quanto um único dia, caso seja necessário.\n\n```python\nURL_PERIODO = (\n    \"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/\"\n    \"CotacaoDolarPeriodo(dataInicial=@dataInicial,dataFinalCotacao=@dataFinalCotacao)\"\n)\n\nURL_DIA = (\n    \"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/\"\n    \"CotacaoDolarDia(dataCotacao=@dataCotacao)\"\n)\n\n\ndef consultar_periodo(data_inicial: datetime, data_final: datetime) -> list[dict]:\n    url = URL_PERIODO + construir_query_periodo(data_inicial, data_final)\n    resposta = requests.get(url).json()\n    return resposta[\"value\"]\n\n\ndef consultar_dia(data: datetime) -> dict | None:\n    url = URL_DIA + construir_query_dia(data)\n    try:\n        resposta = requests.get(url).json()\n        return resposta[\"value\"][0]\n    except Exception:\n        return None\n```\n\n---\n\n# Processamento das Cotações\n\nAqui garantimos que todos os dias do mês tenham valores (preenchendo faltas com o valor do dia anterior).\n\n```python\ndef processar_cotacoes(cotacoes_uteis: list[dict], data_inicial: datetime, data_final: datetime) -> list[float]:\n    cotacoes = [0.0 for _ in range(data_final.day)]\n\n    for cotacao in cotacoes_uteis:\n        dia = datetime.strptime(cotacao[\"dataHoraCotacao\"], \"%Y-%m-%d %H:%M:%S.%f\").day\n        cotacoes[dia - 1] = cotacao[\"cotacaoCompra\"]\n\n    for i in range(data_final.day):\n        if cotacoes[i] == 0.0:\n            if i == 0:\n                dia_fallback = data_inicial\n                cotacao_fallback = None\n\n                while cotacao_fallback is None:\n                    dia_fallback -= timedelta(days=1)\n                    cotacao_fallback = consultar_dia(dia_fallback)\n\n                cotacoes[i] = cotacao_fallback[\"cotacaoCompra\"]\n            else:\n                cotacoes[i] = cotacoes[i - 1]\n\n    return cotacoes\n```\n\n---\n\n# Construção do Gráfico\n\nUsamos Plotly para gerar um gráfico interativo das cotações.\n\n```python\ndef construir_grafico(mes: str, cotacoes, data_inicial: datetime, data_final: datetime):\n    valores = processar_cotacoes(cotacoes, data_inicial, data_final)\n\n    dias = list(range(1, len(valores) + 1))\n\n    df = pd.DataFrame({\"Dia\": dias, \"Cotação (R$)\": valores})\n\n    fig = px.line(\n        df,\n        x=\"Dia\",\n        y=\"Cotação (R$)\",\n        title=f\"Cotações do Dólar — {mes[:2]}/{mes[2:]}\"\n    )\n    fig.show()\n```\n\n---\n\n# Execução Principal\n\n    def main():\n    mes = \"052014\"  # Exemplo de mês escolhido\n    data_inicial, data_final = datas(mes)\n    cotacoes = consultar_periodo(data_inicial, data_final)\n    construir_grafico(mes, cotacoes, data_inicial, data_final)\n\n\nmain()\n```\n    \n\n\n---\n\n# Conclusão\n\nEste trabalho demonstrou como utilizar Python para consultar APIs públicas, tratar dados com Pandas, gerar visualizações com Plotly e apresentar tudo em formato de blog utilizando Quarto. Essa abordagem é muito usada no mercado para análise de dados profissionais.\n\nCaso precise adicionar novos gráficos, indicadores, tabelas ou análises, posso complementar o blog conforme necessário.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}